---
## Author
author:
  name: Арсений Валерьевич Агаев
  email: 1032221668@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №6
subtitle: Адресация IPv4 и IPv6. Двойной стек
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---
# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Арсений Валерьевич Агаев
  * студент
  * Российский университет дружбы народов им. П. Лумумбы
  * [1032221668@rudn.ru](mailto:1032221668@rudn.ru)

:::
::: {.column width="30%"}

:::
::::::::::::::

# Цели и задачи

Изучить принципы распределения и настройки адресного пространства на устройствах сети.

## Разбиение IPv4-сети на подсети

- Задана IPv4-сеть 172.16.20.0/24. Для заданной сети определить префикс, маску, 
broadcast-адрес, число возможных подсетей, диапазон адресов узлов. Разбить сеть 
на 3 подсети с максимально возможным числом адресов узлов 126, 62, 62 соответственно.

- Задана сеть 10.10.1.64/26. Для заданной сети определить префикс, маску, broadcast-адрес, 
число возможных подсетей, диапазон адресов узлов. Выделить в этой сети подсеть на 30 узлов. 
Запишите характеристики для выделенной подсети.

- Задана сеть 10.10.1.0/26. Для этой сети определить префикс, маску, broadcastадрес, 
число возможных подсетей, диапазон адресов узлов. Выделить в этой сети подсеть на 
14 узлов. Записать характеристики для выделенной подсети.

## Разбиение IPv6-сети на подсети
 
- Задана сеть 2001:db8:c0de::/48. Охарактеризовать адрес, определите маску,
префикс, диапазон адресов для узлов сети (краевые значения). Разбить сеть на 2 
подсети двумя способами — с использованием идентификатора подсети и с 
использованием идентификатора интерфейса. Пояснить предложенные варианты разбиения.

- Задана сеть 2a02:6b8::/64. Охарактеризовать адрес, определите маску, префикс, 
диапазон адресов для узлов сети (краевые значения). Разбить сеть на 2 подсети 
двумя способами — с использованием идентификатора подсети и с использованием 
идентификатора интерфейса. Пояснить предложенные варианты разбиения.

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

- Задана топология сети с двумя локальными подсетями (рис. 6.1). Для первой 
подсети выделено адресное пространство с адресами IPv4, для второй — адресное 
пространство с адресами IPv6.

Требуется:

1. Реализовать топологию сети в GNS3;

2. Настроить IPv4-адресацию на устройствах первой подсети и проверить 
подключение между устройствами этой подсети;

3. Настроить IPv6-адресацию на устройствах второй подсети и проверить 
подключение между устройствами этой подсети;

4. Проанализировать захваченный на соединении сервера двойного стека 
адресации с коммутатором трафик ARP, ICMP, ICMPv6.

## Задание для самостоятельного выполнения

Предполагается, что маршрутизатор разбивает сеть на две подсети с адресами
IPv4 и IPv6:
- подсеть 1: 10.10.1.96/27; 2001:DB8:1:1::/64;
- подсеть 2: 10.10.1.16/28; 2001:DB8:1:4::/64.

Необходимо:

1. Охарактеризовать подсети, указать, какие адреса в них входят.

2. Предложить вариант таблицы адресации для заданной топологии и адресного
пространства, причём для интерфейсов маршрутизатора выбрать наименьший адрес в подсети.

3. Настроить IP-адресацию на маршрутизаторе VyOS и оконечных устройствах,
причём на интерфейсах маршрутизатора установить наименьший адрес
в подсети.

4. Проверить подключение между устройствами подсети с помощью команд
ping и trace.

# Содержание исследования

## Разбиение сети на подсети. IPv4

1. Сеть 172.16.20.0/24

    - Префикс: /24
    
    - Маска: 255.255.255.0

    - Broadcast-адрес: 172.16.20.255

    - Число возможных подсетей: 256 (254 для узлов)

    - Диапазон адресов узлов:  172.16.20.1 - 172.16.20.254

    - Подсеть 126: 172.16.20.0/25 (172.16.20.1 - 172.16.20.126)

    - Подсеть 62-1: 172.16.20.128/26 (172.16.20.129 - 172.16.20.190)

    - Подсеть 62-2: 172.16.20.192/26 (172.16.20.193 - 172.16.20.254)

## Разбиение сети на подсети. IPv4

2. Сеть 10.10.1.64/26

    - Префикс: /26
    
    - Маска: 255.255.255.192

    - Broadcast-адрес: 10.10.1.127

    - Число возможных подсетей: 64

    - Диапазон адресов узлов: 10.10.1.65 - 10.10.1.126

    - Подсеть 30: 10.10.1.64/27; Маска: 255.255.255.224; Broadcast: 10.10.1.95; 
    Диапазон: 10.10.1.65 - 10.10.1.94

## Разбиение сети на подсети. IPv4

3. Сеть 10.10.1.0/26

    - Префикс: /26
    
    - Маска: 255.255.255.192

    - Broadcast-адрес: 10.10.1.63

    - Число возможных подсетей: 64

    - Диапазон адресов узлов: 10.10.1.1 - 10.10.1.62

    - Подсеть 14: 10.10.1.0/28; Маска: 255.255.255.240; Broadcast: 10.10.1.15; 
    Диапазон: 10.10.1.1 - 10.10.1.14

## Разбиение сети на подсети. IPv6

1. Сеть 2001:db8:c0de::/48

    - Глобальный

    - Маска (Префикс): /48 (Первые 48 бит фиксированы)

    - 2001:db8:c0de:0000:0000:0000:0000:0000 - 2001:db8:c0de:ffff:ffff:ffff:ffff:ffff

    - Вариант 1: 2001:db8:c0de:0000::/49 (от 0000 до 7FFF) и 2001:db8:c0de:8000::/49 (от 8000 до FFFF)

    - Вариант 2: 2001:db8:c0de:0:0:0:0:0/65 и 2001:db8:c0de:8000:0:0:0:0/65

## Разбиение сети на подсети. IPv6

2. Сеть 2a02:6b8::/64

    - Глобальный

    - Маска (Префикс): /64

    - 2a02:6b8:0000:0000:0000:0000:0000:0000 - 2a02:6b8:0000:0000:ffff:ffff:ffff:ffff

    - Вариант 1: 2a02:6b8::/65 и 2a02:6b8:0:0:8000::/65

    - Вариант 2: 2a02:6b8::/127 и 2a02:6b8::2/127
    
## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

Вначале я разместил устройства и соединил их в соответствии с топологией, 
требуемой по заданию. Также включил захват трафика на соединении между сервером 
двойного стека адресации и ближайшим к нему коммутатором:

![Топология сети](image/1.png){#fig-001 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

После настроил IPv4 на узлах PC1, PC2, Server. Проверил конфигурацию IPv4 
и IPv6 для узлов PC1 и PC2:

- PC1

```
ip 172.16.20.10/25 172.16.20.1
save
show ip
show ipv6
```

- PC2

```
ip 172.16.20.138/25 172.16.20.129
save
show ip
show ipv6
```

- Server

```
ip 64.100.1.10/24 64.100.1.1
save
```

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

![Конфигурация IPv4](image/2.png){#fig-002 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

Теперь настроил IPv4-адресацию для маршрутизатора FRR:

```
configure terminal
hostname msk-avagaev-gw-01
exit
write memory

configure terminal
interface eth0
ip address 172.16.20.1/25
no shutdown
exit

interface eth1
ip address 172.16.20.129/25
no shutdown
exit

interface eth2
ip address 64.100.1.1/24
no shutdown
exit

exit
write memory
```

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

![Конфигурация маршрутизатора FRR](image/3.png){#fig-003 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

После проверил конфигурацию маршрутизатора:

```
show running-config
show interface brief
```

![Проверка конфигурации маршрутизатора FRR](image/4.png){#fig-004 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

С помощью команд ```ping``` и ```trace``` проверил соединение между 
PC1, PC2, Server

![Проверка соединения между узлами IPv4](image/5.png){#fig-005 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

После настроил IPv6 на узлах PC3, PC4, Server. Проверил конфигурацию IPv4 
и IPv6 для узлов PC3 и PC4:

- PC3

```
ip 2001:db8:c0de:12::a/64
save
show ip
show ipv6
```

- PC4

```
ip 2001:db8:c0de:13::a/64
save
show ip
show ipv6
```

- Server

```
ip 2001:db8:c0de:11::a/64
save
```

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

![Конфигурация IPv6](image/6.png){#fig-006 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

Теперь настроил IPv6-адресацию для маршрутизатора VyOS:

```
configure
set system host-name hostname msk-avagaev-gw-02
compare
commit
save
exit
reboot

configure
set interfaces ethernet eth0 address 2001:db8:c0de:12::1/64
set service router-advert interface eht0 prefix 2001:db8:c0de:12::/64

set interfaces ethernet eth1 address 2001:db8:c0de:13::1/64
set service router-advert interface eht0 prefix 2001:db8:c0de:13::/64

set interfaces ethernet eth2 address 2001:db8:c0de:11::1/64
set service router-advert interface eht0 prefix 2001:db8:c0de:11::/64

compare
commit
save
show interfaces
```

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

![Конфигурация маршрутизатора VyOS](image/7.png){#fig-007 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

С помощью команд ```ping``` и ```trace``` проверил соединение между 
PC3, PC4, Server

![Проверка соединения между узлами IPv6](image/8.png){#fig-008 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

С помощью команд ```ping``` и ```trace``` проверил соединение между 
PC1, PC3, Server

![Проверка соединения между сетями IPv4 и IPv6](image/9.png){#fig-009 width=70%}

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

После посмотрел захваченные пакеты в Wireshark:

![Захваченные пакеты Wireshark](image/10.png){#fig-010 width=70%}

Из них видно, что узлы действительно обменивались пакетами, производили 
Broadcast запросы по протоколу ARP, чтобы установить MAC адрес 
устройства-получателя.

## Задание для самостоятельной работы

1. Подсеть 1: 10.10.1.96/27; 2001:DB8:1:1::/64;

    - Broadcast: 10.10.1.127

    - Диапазон: 10.10.1.97 - 10.10.1.126; ::0 - ::ffff:ffff:ffff:ffff

2. Подсеть 2: 10.10.1.16/28; 2001:DB8:1:4::/64.

    - Broadcast: 10.10.1.31

    - Диапазон: 10.10.1.17 - 10.10.1.30; ::0 - ::ffff:ffff:ffff:ffff

## Задание для самостоятельной работы
    
3. Таблица адресации

| Устройство | Интерфейс |    IPv4    |      IPv6       |    Шлюз    |
|------------|-----------|------------|-----------------|------------|
|   gw-01    |   eth0    | 10.10.1.97 | 2001:DB8:1:1::1 |    N/A     |
|   gw-01    |   eth1    | 10.10.1.17 | 2001:DB8:1:4::1 |    N/A     |
|   PC1      |   NIC     | 10.10.1.98 | 2001:DB8:1:1::2 | 10.10.1.97 |
|   PC2      |   NIC     | 10.10.1.18 | 2001:DB8:1:4::2 | 10.10.1.17 |
: Таблица адресации {#tbl-address}

## Задание для самостоятельной работы

После приступил к настройке IP-адресации на маршрутизаторе VyOS и оконечных 
устройствах, согласно таблице:

- PC1

```
ip 10.10.1.98/27 10.10.1.97
ip 2001:DB8:1:1::2/64
save
show ip
show ipv6
```

- PC2

```
ip 10.10.1.18/27 10.10.1.17
ip 2001:DB8:1:4::2/64
save
show ip
show ipv6
```

## Задание для самостоятельной работы

- Маршрутизатор VyOS

```
configure
set interfaces ethernet eth0 address 10.10.1.97/27
set interfaces ethernet eth0 address 2001:DB8:1:1::1/64
set service router-advert interface eth0 prefix 2001:DB8:1:1::/64

set interfaces ethernet eth1 address 10.10.1.17/28
set interfaces ethernet eth0 address 2001:DB8:1:4::1/64
set service router-advert interface eth0 prefix 2001:DB8:1:4::/64

delete interfaces ethernet eth0 address dhcp

compare
commit
save
exit
```

## Задание для самостоятельной работы

![Конфигурация самостоятельной работы](image/11.png){#fig-011 width=70%}

## Задание для самостоятельной работы

После проверил подключение между устройствами с помощью ```ping``` и ```trace```:

![Проверка соединения между устройствами](image/12.png){#fig-012 width=70%}

# Результаты

Я успешно изучил принципы распределения и настройки адресного пространства на 
устройствах сети.
